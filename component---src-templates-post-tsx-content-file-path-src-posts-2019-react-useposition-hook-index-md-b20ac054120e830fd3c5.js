(self.webpackChunktrekhleb_github_io=self.webpackChunktrekhleb_github_io||[]).push([[9789],{3150:function(n,a,s){var t=s(9720).w_;n.exports.C=function(n){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.953,2C6.465,2,2,6.486,2,12s4.486,10,10,10s10-4.486,10-10S17.493,2,11.953,2z M12,20c-4.411,0-8-3.589-8-8 s3.567-8,7.953-8C16.391,4,20,7.589,20,12S16.411,20,12,20z"}},{tag:"path",attr:{d:"M11 7H13V14H11zM11 15H13V17H11z"}}]})(n)}},9881:function(n,a,s){var t=s(9720).w_;n.exports.L=function(n){return t({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M8 16A8 8 0 108 0a8 8 0 000 16zm.93-9.412l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM8 5.5a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"}}]})(n)}},4363:function(n,a,s){var t=s(9720).w_;n.exports.v=function(n){return t({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"}}]})(n)}},550:function(n,a,s){var t=s(9720).w_;n.exports.T=function(n){return t({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 6 12 12 16 14"}}]})(n)}},405:function(n,a,s){"use strict";s.r(a),s.d(a,{default:function(){return r}});var t=s(1151),e=s(7294);function o(n){const a=Object.assign({span:"span",h2:"h2",a:"a",p:"p",em:"em",strong:"strong",h3:"h3"},(0,t.ah)(),n.components);return e.createElement(e.Fragment,null,e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 45.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAbYd1xBw/8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACAxIEEEL/2gAIAQEAAQUCpWduPJImEFnev//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAIBBQEAAAAAAAAAAAAAAAECABAREiExcf/aAAgBAQAGPwIjbF9i/BC7uVxMBXkHlf/EABsQAQACAgMAAAAAAAAAAAAAAAEAESExEKHB/9oACAEBAAE/IaN1DvVSymUS3NbSLhbMR7HnBP/aAAwDAQACAAMAAAAQ8A//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAfEAEAAgIABwAAAAAAAAAAAAABACERQRAxUWFxgfD/2gAIAQEAAT8QDnzVZ0TWFL7zD2UFDsGhuMusLmz3PkdeDbzP/9k=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="usePosition"\n        title=""\n        src="/static/b2e801b0c809c1b2059b4e0d712a71b1/a2510/01-cover.jpg"\n        srcset="/static/b2e801b0c809c1b2059b4e0d712a71b1/0479a/01-cover.jpg 250w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/41099/01-cover.jpg 500w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/a2510/01-cover.jpg 1000w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/c58a3/01-cover.jpg 1500w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/d9c39/01-cover.jpg 1800w"\n        sizes="(max-width: 1000px) 100vw, 1000px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",e.createElement(a.h2,{id:"tldr",style:{position:"relative"}},"TL;DR",e.createElement(a.a,{href:"#tldr","aria-label":"tldr permalink",className:"gatsby-remark-autolink-header-anchor after"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",e.createElement(a.p,null,"In this article we’ll create a React ",e.createElement(a.em,null,"usePosition()")," hook to fetch and follow browser’s location. Under the hood we’ll use ",e.createElement(a.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/getCurrentPosition"},"getCurrentPosition")," and ",e.createElement(a.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/watchPosition"},"watchPosition")," functions that are provided by global object ",e.createElement(a.em,null,"navigator.geolocation"),". The final version of the ",e.createElement(a.em,null,"usePosition()")," hook is ",e.createElement(a.a,{href:"https://github.com/trekhleb/use-position"},"published on GitHub")," and ",e.createElement(a.a,{href:"https://www.npmjs.com/package/use-position"},"NPM")," and is ready to be consumed by your apps."),"\n",e.createElement(a.h2,{id:"why-we-might-need-useposition-hook-at-all",style:{position:"relative"}},"Why we might need usePosition() hook at all",e.createElement(a.a,{href:"#why-we-might-need-useposition-hook-at-all","aria-label":"why we might need useposition hook at all permalink",className:"gatsby-remark-autolink-header-anchor after"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",e.createElement(a.p,null,"One of the advantages of ",e.createElement(a.a,{href:"https://reactjs.org/docs/hooks-intro.html"},"React hooks")," is ",e.createElement(a.em,null,"ability to separate concerns"),". Instead of having a state object with, let’s say, geo-position ",e.createElement(a.strong,null,"and")," socket connection we might avoid using state at all and just use two different hooks that will handle the state management for us. Even more, instead of initiating browser position watcher ",e.createElement(a.strong,null,"and")," opening a socket connection in the same ",e.createElement(a.em,null,"componentDidMount()")," callback we might split this logic into two independent hooks. This gives us cleaner and more maintainable code."),"\n",e.createElement(a.h2,{id:"how-were-going-to-useposition-hook",style:{position:"relative"}},"How we’re going to usePosition() hook",e.createElement(a.a,{href:"#how-were-going-to-useposition-hook","aria-label":"how were going to useposition hook permalink",className:"gatsby-remark-autolink-header-anchor after"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",e.createElement(a.p,null,"Let’s do some reverse engineering and imagine that we already have a ",e.createElement(a.em,null,"usePosition()")," hook implemented. Here is how we might want to use it:"),"\n",e.createElement(a.p,null,e.createElement(a.em,null,"⚠️ All code samples below use wrong symbol =≻ instead of => for lambda functions annotations. Be aware of this while copying the code and trying to execute it since it might not work. Please replace ≻ with > manually in your code. For some reason I had issues with pasting the > symbol inside the code block. Sorry for inconvenience.")),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span>usePosition<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./usePosition\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">UsePositionDemo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">,</span> error<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">usePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>code<span class="token operator">></span>\n      <span class="token literal-property property">latitude</span><span class="token operator">:</span> <span class="token punctuation">{</span>latitude<span class="token punctuation">}</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>\n      <span class="token literal-property property">longitude</span><span class="token operator">:</span> <span class="token punctuation">{</span>longitude<span class="token punctuation">}</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>\n      <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token punctuation">{</span>error<span class="token punctuation">}</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"You see, it is only one line with ",e.createElement(a.em,null,"usePosition()")," hook, and you already have the data (",e.createElement(a.em,null,"latitude")," and ",e.createElement(a.em,null,"longitude"),"). We don’t even use ",e.createElement(a.em,null,"useState()")," and ",e.createElement(a.em,null,"useEffect()")," here. Position subscription and watcher cleanup is incapsulated in ",e.createElement(a.em,null,"usePosition()")," hook. Now, the redraw component magic will be handled for us by React, and we will see the ",e.createElement(a.em,null,e.createElement("code",null,"…"))," block constantly being updated with the latest position value of the browser. Looks pretty neat and clean."),"\n",e.createElement(a.h3,{id:"useposition-hook-implementation",style:{position:"relative"}},"usePosition() hook implementation",e.createElement(a.a,{href:"#useposition-hook-implementation","aria-label":"useposition hook implementation permalink",className:"gatsby-remark-autolink-header-anchor after"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",e.createElement(a.p,null,"Our custom ",e.createElement(a.em,null,"usePosition()")," hook is just a JavaScript function that uses other hooks like ",e.createElement(a.a,{href:"https://reactjs.org/docs/hooks-state.html"},"useState()")," and ",e.createElement(a.a,{href:"https://reactjs.org/docs/hooks-effect.html"},"useEffect()"),". It will look something like:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// imports go here...</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">usePosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// code goes here...</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"We will use ",e.createElement(a.em,null,"useEffect()")," hook to hook to the moment in time when a component (that will consume our hook) is rendered and to subscribe to geolocation changes. We will also use ",e.createElement(a.em,null,"useState()")," hook to store ",e.createElement(a.em,null,"latitude"),", ",e.createElement(a.em,null,"longitude")," and ",e.createElement(a.em,null,"error")," message (in case if user won’t allow browser to share its position). So we need to import these hooks first:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">usePosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// code goes here...</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Let’s init a storage for position and for error:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">usePosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// other code goes here...</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Let’s return a desirable values from the function. We don’t have them yet but let’s return initial values so far and fill them later:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">usePosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// other code goes here...</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>position<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Here is a key part of our hook — fetching the browser’s position. We will execute fetching logic after component has been rendered (useEffect hook)."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">usePosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// callbacks will go here...</span>\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> geo <span class="token operator">=</span> navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>geo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">\'Geolocation is not supported\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    watcher <span class="token operator">=</span> geo<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span>onChange<span class="token punctuation">,</span> onError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> geo<span class="token punctuation">.</span><span class="token function">clearWatch</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>position<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"In useEffect() hook we first do some checks to see if the browser is supporting ",e.createElement(a.em,null,"navigator.geolocation"),". If geolocation is not supported we’re setting up an error and returning from the effect. In case if ",e.createElement(a.em,null,"navigator.geolocation")," is supported we subscribe to position changes by providing an ",e.createElement(a.em,null,"onChange()")," and ",e.createElement(a.em,null,"onError()")," callbacks (we’ll add them in a moment). Notice that we’re returning a lambda function from ",e.createElement(a.em,null,"useEffect()"),". In that lambda function we are clearing the watcher once the component is unmounted. So this subscribe/unsubscribe logic will be handled internally by our ",e.createElement(a.em,null,"usePosition()")," hook and consumers shouldn’t worry about it."),"\n",e.createElement(a.p,null,"Let’s now add missing callbacks:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">usePosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>coords<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token literal-property property">latitude</span><span class="token operator">:</span> coords<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span>\n      <span class="token literal-property property">longitude</span><span class="token operator">:</span> coords<span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">onError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">setError</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> geo <span class="token operator">=</span> navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>geo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">\'Geolocation is not supported\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    watcher <span class="token operator">=</span> geo<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span>onChange<span class="token punctuation">,</span> onError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> geo<span class="token punctuation">.</span><span class="token function">clearWatch</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>position<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"And we’re done. The hook ",e.createElement(a.em,null,"usePosition()")," may be consumed and it incapsulates only geolocation related logic."),"\n",e.createElement(a.h3,{id:"afterword",style:{position:"relative"}},"Afterword",e.createElement(a.a,{href:"#afterword","aria-label":"afterword permalink",className:"gatsby-remark-autolink-header-anchor after"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",e.createElement(a.p,null,"You may find a ",e.createElement(a.a,{href:"https://trekhleb.dev/use-position/"},"demo")," and more detailed implementation of ",e.createElement(a.a,{href:"https://github.com/trekhleb/use-position"},"usePosition() hook on GitHub"),". I hope this example was informative for you. Happy coding!"))}var p=function(n){void 0===n&&(n={});const{wrapper:a}=Object.assign({},(0,t.ah)(),n.components);return a?e.createElement(a,n,e.createElement(o,n)):o(n)},c=s(7084);const l=n=>{const{data:a,children:s}=n;return e.createElement(c.Z,{post:a},s)};function r(n){return e.createElement(l,n,e.createElement(p,n))}},7084:function(n,a,s){"use strict";s.d(a,{Z:function(){return m}});var t=s(7294),e=s(578),o=s(4363),p=s(550),c=s(9737),l=s(5103),r=s(2717),i=s(8288);var u=n=>{var a,s,e,u,k,d,m;const{post:h,children:g}=n,A=null!=h&&null!==(a=h.mdx)&&void 0!==a&&null!==(s=a.frontmatter)&&void 0!==s&&s.date?t.createElement(l.Z,{className:"mr-6 mb-6 text-gray-500 text-sm"},t.createElement(o.v,{className:"mr-1"}),null==h||null===(e=h.mdx)||void 0===e?void 0:e.frontmatter.date):null,f=null!=h&&null!==(u=h.mdx)&&void 0!==u&&u.timeToRead?t.createElement(l.Z,null,t.createElement(p.T,{className:"mr-1"}),(0,r.j)(null==h||null===(k=h.mdx)||void 0===k?void 0:k.timeToRead)," min to read"):null;return t.createElement("div",{className:"flex flex-col items-center"},t.createElement("article",{className:"w-full prose prose-sm sm:prose overflow-hidden prose-red",style:{maxWidth:"860px"}},t.createElement(c.Z,null,(null===(d=h.mdx)||void 0===d||null===(m=d.frontmatter)||void 0===m?void 0:m.title)||""),t.createElement(l.Z,null,A,f),t.createElement(i.Z,null,g)))},k=s(7943),d=s(5677);var m=n=>{var a,s,o,p,c,l,r,m,h,g,A;const{post:f,children:w}=n;return t.createElement(e.Z,null,t.createElement(k.ZP,{title:(null===(a=f.mdx)||void 0===a||null===(s=a.frontmatter)||void 0===s?void 0:s.title)||"",titleMode:k.H0,description:(null===(o=f.mdx)||void 0===o||null===(p=o.frontmatter)||void 0===p?void 0:p.summary)||"",image:(null===(c=f.mdx)||void 0===c||null===(l=c.frontmatter)||void 0===l||null===(r=l.cover)||void 0===r||null===(m=r.childImageSharp)||void 0===m||null===(h=m.gatsbyImageData)||void 0===h||null===(g=h.images)||void 0===g||null===(A=g.fallback)||void 0===A?void 0:A.src)||"",type:k.Sp}),t.createElement(u,{post:f},w),t.createElement("div",{className:"flex flex-row justify-center items-center mt-16"},t.createElement("div",{className:"max-w-md"},t.createElement(i.Z,null,t.createElement(d.Z,null)))))}},2091:function(n,a,s){"use strict";s.d(a,{Iy:function(){return c},hW:function(){return l}});var t=s(7294),e=s(9881),o=s(3150),p=s(5103);const c="info",l="error",r={[c]:t.createElement(e.L,{size:18}),[l]:t.createElement(o.C,{size:18})},i={[c]:"text-blue-600 bg-blue-100",[l]:"text-red-600 bg-red-100"};a.ZP=n=>{const{children:a,type:s}=n;return a?t.createElement("div",{className:"py-3 px-4 rounded-md "+i[s]},t.createElement(p.Z,null,t.createElement("div",{className:"mr-3"},r[s]),t.createElement("div",{className:"text-sm"},a))):null}},8288:function(n,a,s){"use strict";var t=s(4578),e=s(7294),o=s(2091);let p=function(n){function a(a){var s;return(s=n.call(this,a)||this).state={hasError:!1},s}(0,t.Z)(a,n),a.getDerivedStateFromError=function(){return{hasError:!0}};var s=a.prototype;return s.componentDidCatch=function(n,a){console.error(n,a),this.setState({hasError:!0})},s.render=function(){const{children:n}=this.props,{hasError:a}=this.state;return a?e.createElement(o.ZP,{type:o.hW},"Component has crashed"):n},a}(e.Component);a.Z=p},9737:function(n,a,s){"use strict";var t=s(7294),e=s(4519);a.Z=n=>{const{children:a,className:s=""}=n,o="mb-6 uppercase font-extrabold "+s;return t.createElement(e.Z,{level:e._.h1,className:o},a)}},5677:function(n,a,s){"use strict";var t=s(7294);a.Z=n=>{const{withHeader:a=!0}=n,s="border py-2 px-3 mb-3 rounded border-gray-300 border-solid appearance-none",e=a?t.createElement("h1",{className:"text-grey-darkest uppercase font-bold text-xl mb-3"},"Subscribe to the Newsletter"):null;return t.createElement("div",{className:"bg-white rounded-md shadow-md p-8"},e,t.createElement("p",{className:"text-sm mb-3"},"Get my latest posts and project updates by email"),t.createElement("form",{action:"https://dev.us1.list-manage.com/subscribe/post?u=7714f14ff32085c685da2cfaa&amp;id=53ffa81463",method:"post",className:"flex flex-col"},t.createElement("input",{placeholder:"First Name",type:"text",name:"FNAME",className:s,required:!0}),t.createElement("input",{placeholder:"Email",type:"email",name:"EMAIL",className:s,required:!0}),t.createElement("div",{className:"hidden","aria-hidden":"true"},t.createElement("input",{type:"text",name:"b_7714f14ff32085c685da2cfaa_53ffa81463",tabIndex:-1})),t.createElement("input",{type:"submit",value:"Subscribe",className:"transition duration-200 ease-in-out bg-black text-white py-2 px-3 rounded shadow-sm cursor-pointer hover:bg-gray-800"})))}},2717:function(n,a,s){"use strict";s.d(a,{D:function(){return e},j:function(){return t}});const t=n=>{if("number"!=typeof n)return null;return Math.ceil(1*n)||1},e=async n=>new Promise((a=>{setTimeout(a,n)}))},1151:function(n,a,s){"use strict";s.d(a,{ah:function(){return o}});var t=s(7294);const e=t.createContext({});function o(n){const a=t.useContext(e);return t.useMemo((()=>"function"==typeof n?n(a):{...a,...n}),[a,n])}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-src-posts-2019-react-useposition-hook-index-md-b20ac054120e830fd3c5.js.map